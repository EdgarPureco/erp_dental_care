<div class="ion-page">

  <app-vertical-menu-admin></app-vertical-menu-admin>

  <ion-content id="main-content">
    <div style="margin: 6% 2% 0 2%;">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Inventario</ion-card-title>
          <ion-card-subtitle>
            <ion-searchbar animated="true" placeholder="Buscar" (ionInput)="search($event)"></ion-searchbar>
          </ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <ion-list *ngIf="results">

            <ion-card *ngFor="let item of results">
              <ion-card-content>
                <ion-item-group>
                  <ion-item>
                    <ion-label>
                      <h1>{{item.name}}</h1>
                      <p>Costo: {{item.cost}}</p>
                      <p>Cantidad: {{item.stock}}</p>
                      <p>Unidad de uso: {{item.use_unit}}</p>
                      <p>Cantidad en unidad de uso: {{item.stock_in_use_unit}}</p>
                    </ion-label>
                  </ion-item>
                </ion-item-group>
                <ion-item-group>
                  <ion-button (click)="openDetails(item.id)" color="secondary">
                    Detalles <ion-icon aria-hidden="true" name="eye" slot="end"></ion-icon>
                  </ion-button>

                  <ion-button (click)="openAdd(item.id)" color="primary">
                    Comprar <ion-icon slot="end" aria-hidden="true" name="bag-add"></ion-icon>
                  </ion-button>
                  <ion-button (click)="openSells(item.id)" color="medium">
                    Ventas <ion-icon slot="end" aria-hidden="true" name="cash"></ion-icon>
                  </ion-button>
                  <ion-button (click)="openBuys(item.id)" color="medium">
                    Compras <ion-icon slot="end" aria-hidden="true" name="cart"></ion-icon>
                  </ion-button>
                </ion-item-group>

              </ion-card-content>
            </ion-card>



          </ion-list>
          <ion-list *ngIf="data.length===0">
            <ion-list-header>
              <ion-skeleton-text [animated]="true" style="width: 80px"></ion-skeleton-text>
            </ion-list-header>
            <ion-item>
              <ion-thumbnail slot="start">
                <ion-skeleton-text [animated]="true"></ion-skeleton-text>
              </ion-thumbnail>
              <ion-label>
                <h3>
                  <ion-skeleton-text [animated]="true" style="width: 80%;"></ion-skeleton-text>
                </h3>
                <p>
                  <ion-skeleton-text [animated]="true" style="width: 60%;"></ion-skeleton-text>
                </p>
                <p>
                  <ion-skeleton-text [animated]="true" style="width: 30%;"></ion-skeleton-text>
                </p>
              </ion-label>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>

    </div>

    <!-- Start Modal Buy Supply -->

    <ion-modal [isOpen]="modalAdd" (willDismiss)="onWillDismiss()">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>Agregar Compra de Insumo</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="modalAdd=false"><ion-icon name="close"></ion-icon></ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content>

          <ion-list>
            <form (ngSubmit)="onSubmit()" [formGroup]="supplyForm">
              <ion-list class="ion-margin">
                <ion-item>
                  <ion-input formControlName="quantity" label="Cantidad" type="number"
                    placeholder="Cantidad"></ion-input>
                </ion-item>
                <ion-item>
                  <ion-checkbox (click)="expires=true">El insumo caduca:</ion-checkbox>
                </ion-item>
                <ion-item *ngIf="expires">
                  <ion-datetime presentation="date" formControlName="expiration_date"
                    label="Fecha de Expiración"></ion-datetime>
                </ion-item>

              </ion-list>

              <ion-button style="margin: 10px 20px 0px 20px;" expand="block" type="submit"
                [disabled]="!supplyForm.valid">
                Guardar <ion-icon slot="end" name="save"></ion-icon>
              </ion-button>
            </form>
          </ion-list>
        </ion-content>
      </ng-template>
    </ion-modal>
    <!-- End Modal Buy Supply -->


    <!-- Start Modal Sells Supply -->

    <ion-modal [isOpen]="modalSells" (willDismiss)="onWillDismiss()">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>Ventas</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="modalSells=false"><ion-icon name="close"></ion-icon></ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content>

          <ion-list *ngFor="let item of sells">
            <ion-card *ngIf="item!==null">
              <ion-card-header>
                <ion-card-title>{{item.supply.name}}</ion-card-title>
              </ion-card-header>

              <ion-card-content>
                Cantidad: {{item.quantity}}<br>
                Precio: {{item.price}} <br>
                SubTotal: {{item.subtotal}} <br>
                IVA: {{item.vat}} <br>
                Total: {{item.total}} <br>

              </ion-card-content>
            </ion-card>
          </ion-list>
        </ion-content>
      </ng-template>
    </ion-modal>
    <!-- End Modal Sells Supply -->


    <!-- Start Modal Buys Supply -->

    <ion-modal [isOpen]="modalBuys" (willDismiss)="onWillDismiss()">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>Compras</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="modalBuys=false"><ion-icon name="close"></ion-icon></ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content>


          <ion-card-content>
            <ion-list>
              <ion-item *ngFor="let item of buys">
                <ion-card>
                  <ion-card-header>
                    <ion-card-title *ngIf="item.expiration_date">Caduca: {{formatDateToLetter(item.expiration_date)}}</ion-card-title>
                    <ion-card-title>Comprado: {{formatDateToLetter(item.buy_date)}}</ion-card-title>
                  </ion-card-header>

                  <ion-card-content>
                    Cantidad: {{item.quantity}}<br>
                    Cantidad usable disponible: {{item.available_use_quantity}}<br>
                  </ion-card-content>
                </ion-card>
              </ion-item>
            </ion-list>

          </ion-card-content>
        </ion-content>
      </ng-template>
    </ion-modal>
    <!-- End Modal Buys Supply -->


    <!-- Start Details Supply -->
    <ion-modal [isOpen]="modalDetails" (willDismiss)="onWillDismiss()">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>Detalles</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="modalDetails=false"><ion-icon name="close"></ion-icon></ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content>

          <ion-card *ngIf="supply!==null">
            <img [src]="getImgSrcFromBase64(supply.image)" />
            <ion-card-header>
              <ion-card-title>{{supply.name}}</ion-card-title>
            </ion-card-header>

            <ion-card-content>
              <h1>Información:</h1><br>
              Costo: {{supply.cost}} <br>
              Vendible: {{supply.is_salable == true ? "Si" : "No" }} <br>
              <p *ngIf="supply.is_salable">Precio: {{supply.price}}<br></p>
              Unidad de compra: {{supply.buy_unit}} <br>
              Unidad de uso: {{supply.use_unit}} <br>
              Equivalencia: {{supply.equivalence}} <br>
              Costo: {{supply.cost}}<br>
              Cantidad: {{supply.stock}}<br>
              Unidad de uso: {{supply.use_unit}}<br>
              Cantidad en unidad de uso: {{supply.stock_in_use_unit}}<br><br>
              <h1>Inventario:</h1>
              <ion-list>
                <ion-item *ngFor="let item of inventory">
                  <ion-card>
                    <ion-card-header>
                      <ion-card-title *ngIf="item.expiration_date">Caduca: {{formatDateToLetter(item.expiration_date)}}</ion-card-title>
                      <ion-card-title>Comprado: {{formatDateToLetter(item.buy_date)}}</ion-card-title>
                    </ion-card-header>

                    <ion-card-content>
                      Cantidad: {{item.quantity}}<br>
                      Cantidad usable disponible: {{item.available_use_quantity}}<br>
                    </ion-card-content>
                  </ion-card>
                </ion-item>
              </ion-list>

            </ion-card-content>
          </ion-card>

        </ion-content>
      </ng-template>
    </ion-modal>
    <!-- End Details Add Supply -->


    <ion-img class="water-mark" src="../assets/logo-no-background.png" alt="AzTech"></ion-img>

  </ion-content>


</div>